# logstash.conf — Pipeline para ingerir dataset NDJSON no Elasticsearch (Aula 02)
# Variáveis (com defaults):
#   ES_HOST   (default: http://elasticsearch:9200)
#   INDEX     (default: infra-hosts)
#   DATA_FILE (default: /data/dados-10000-ago-2025-logstash.ndjson)

input {
  file {
    path => "${DATA_FILE:/data/dados-10000-ago-2025-logstash.ndjson}"
    start_position => "beginning"
    sincedb_path   => "/dev/null"
    codec => json
  }
}

filter {
  date { match => ["@timestamp", "ISO8601"] }
  mutate { lowercase => ["status"] }
}

output {
  elasticsearch {
    hosts  => ["${ES_HOST:http://elasticsearch:9200}"]
    index  => "${INDEX:infra-hosts}"
    action => "index"
  }
  stdout { codec => dots }
}
